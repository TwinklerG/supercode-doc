<h1 align="center">Supercode</h1>

```mermaid
---
title: åŒ…å›¾ï¼ˆæœªå®Œå–„ï¼‰
---
graph
A["UserUI"]
B["ProblemUI"]
C["OJResultUI"]
D["User"]
E["Problem"]
F["OJResult"]
G["Shopping"]
H["UserDB"]
I["ProblemDB"]
J["OJResultDB"]
K["ShoppingDB"]
A--->D
B--->E
B--->G
A--->G
C--->F
B--->F
D--->H
E--->I
F--->J
G--->K
A--->F
```

## ç”¨æˆ·ç®¡ç†

**ç”¨æˆ·è¡¨**

| å­—æ®µ     | æ•°æ®ç±»å‹                 | æè¿°         |
| -------- | ------------------------ | ------------ |
| uid      | auto_generate            | ç”¨æˆ·å”¯ä¸€æ ‡è¯† |
| username | String(unique, not null) | ç”¨æˆ·å       |
| password | String(not null)         | å¯†ç          |
| email    | String(not null)         | é‚®ç®±         |
| role     | String(æšä¸¾ç±»Serialize)  | ç”¨æˆ·èº«ä»½     |

ç”¨æˆ·èº«ä»½ï¼šè¶…çº§ç®¡ç†å‘˜ï¼Œç®¡ç†å‘˜ï¼Œæ™®é€šç”¨æˆ·

### è¶…çº§ç®¡ç†å‘˜

> åˆ«åï¼š`root`

ç®€ä»‹ï¼šè¿™æ˜¯ç³»ç»Ÿåˆ›å»ºæ—¶è‡ªåŠ¨åˆ›å»ºçš„åˆå§‹ç®¡ç†å‘˜ï¼Œæ‹¥æœ‰**æœ€é«˜æƒåŠ›**ã€‚

è¶…çº§ç®¡ç†å‘˜å¯ä»¥è·å–ã€æ–°å»ºã€åˆ é™¤å’Œä¿®æ”¹æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯ï¼Œ

### ç®¡ç†å‘˜

> åˆ«åï¼š`admin`

ç®€ä»‹ï¼šç®¡ç†å‘˜èº«ä»½ç”±è¶…çº§ç®¡ç†å‘˜/ç®¡ç†å‘˜èµ‹äºˆæ™®é€šç”¨æˆ·ï¼Œä¹Ÿå¯è¢«è¶…çº§ç®¡ç†å‘˜é™çº§ä¸ºæ™®é€šç”¨æˆ·

ç®¡ç†å‘˜å¯ä»¥è·å–ã€æ–°å»ºæ‰€æœ‰ç”¨æˆ·ä¿¡æ¯ï¼Œç®¡ç†å‘˜å¯ä»¥ä¿®æ”¹å’Œåˆ é™¤æ™®é€šç”¨æˆ·çš„ä¿¡æ¯ã€‚

### æ™®é€šç”¨æˆ·

| åˆ«åï¼š`user`

ç®€ä»‹ï¼šæ™®é€šç”¨æˆ·ç”±ç®¡ç†å‘˜/è¶…çº§ç®¡ç†å‘˜åˆ›å»ºï¼Œå¯ä»¥ä¿®æ”¹è‡ªå·±çš„ä¿¡æ¯(uuid, roleå­—æ®µé™¤å¤–)

## ä»£ç è¯„æµ‹

**è¯„æµ‹è®°å½•è¡¨**

| å­—æ®µ            | æ•°æ®ç±»å‹                | æè¿°                                       |
| --------------- | ----------------------- | ------------------------------------------ |
| submit_id       | auto_generate           | æäº¤è®°å½•å”¯ä¸€æ ‡è¯†                           |
| user_id         | foreign_key             | æäº¤ç”¨æˆ·å”¯ä¸€æ ‡è¯†                           |
| problem_id      | foreign_key             | é¢˜ç›®å”¯ä¸€æ ‡è¯†                               |
| language        | String(æšä¸¾ç±»)          | ç¼–ç¨‹è¯­è¨€                                   |
| code            | String                  | ä»£ç                                        |
| time            | Int                     | è¿è¡Œæ—¶é—´                                   |
| memory          | Int                     | å†…å­˜å ç”¨                                   |
| result          | String(æšä¸¾ç±»Serialize) | è¯„æµ‹ç»“æœ                                   |
| stdin           | `List<String>`          | æ ‡å‡†è¾“å…¥                                   |
| stdout          | `List<String>`          | æ ‡å‡†è¾“å‡º                                   |
| stderr          | `List<String>`          | æ ‡å‡†é”™è¯¯è¾“å‡º                               |
| exit_code       | `List<Int>`             | é€€å‡ºç ï¼ˆéƒ¨åˆ†æœªè¢«æµ‹è¯•çš„æµ‹è¯•ç‚¹å‡è¢«è®¾ç½®ä¸º-1ï¼‰ |
| submission_time |                         | æäº¤æ—¶é—´                                   |

**é¢˜ç›®å†…å®¹è¡¨**

| å­—æ®µ        | æ•°æ®ç±»å‹       | æè¿°             |
| ----------- | -------------- | ---------------- |
| problem_id  | auto_generate  | é¢˜ç›®å”¯ä¸€æ ‡è¯†     |
| title       | String         | æ ‡é¢˜             |
| description | String         | æè¿°             |
| stdin       | `List<String>` | æ ·ä¾‹æ ‡å‡†è¾“å…¥     |
| stdout      | `List<String>` | æ ·ä¾‹æ ‡å‡†è¾“å‡º     |
| stderr      | `List<String>` | æ ·ä¾‹æ ‡å‡†é”™è¯¯è¾“å‡º |

**é¢˜ç›®æµ‹è¯•è¡¨**

| å­—æ®µ         | æ•°æ®ç±»å‹       | æè¿°             |
| ------------ | -------------- | ---------------- |
| problem_id   | foreign_key    | é¢˜ç›®å”¯ä¸€æ ‡è¯†     |
| time_limit   | Int            | æ—¶é—´é™åˆ¶         |
| memory_limit | Int            | å†…å­˜é™åˆ¶         |
| stdin        | `List<String>` | æ ‡å‡†è¾“å…¥         |
| stdout       | `List<String>` | æ­£ç¡®æ ‡å‡†è¾“å‡º     |
| stderr       | `List<String>` | æ­£ç¡®æ ‡å‡†é”™è¯¯è¾“å‡º |

è¶…çº§ç®¡ç†å‘˜ï¼Œç®¡ç†å‘˜ï¼Œæ™®é€šç”¨æˆ·å‡å¯ä»¥æäº¤ä»£ç è¿›è¡Œè¯„æµ‹

ä»£ç è¯„æµ‹ä½œä¸º`Runner`åˆ†å¸ƒå¼åœ°éƒ¨ç½²åœ¨ä¸åŒæœåŠ¡å™¨çš„ä¸åŒç«¯å£ã€‚å¯¹äºç¼–è¯‘å‹è¯­è¨€ï¼Œåœ¨æœ¬æœºè¿›è¡Œç¼–è¯‘å’Œæ„å»ºï¼Œç„¶åä½¿ç”¨dockerè¿è¡Œï¼›å¯¹äºè§£é‡Šå‹è¯­è¨€ï¼Œç›´æ¥åœ¨dockerè¿è¡Œã€‚

é™åˆ¶æ¯ä½ç”¨æˆ·çš„æäº¤æ¬¡æ•°é™åˆ¶ï¼Œå¦‚æ¯åˆ†é’Ÿ3æ¬¡

åç«¯ä¸Runneré€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œè¯·æ±‚å’Œé€šä¿¡ã€‚

**è¯„æµ‹è¯·æ±‚**

```mermaid
flowchart LR
A@{shape: circle, label: "Server"}
B@{shape: subprocess, label: "Queue"}
C@{shape: circle, label: "Runner0"}
D@{shape: circle, label: "Runner1"}
A--->B
B--->C
B--->D
B--->...
```

**è¯„æµ‹ç»“æœè¿”å›**

```mermaid
flowchart LR
A@{shape: circle, label: "RunnerX"}
B@{shape: subprocess, label: "Queue"}
C@{shape: circle, label: "Server"}
A--->B
B--->C
```

## ä»˜è´¹å†…å®¹

**é¢˜ç›®æƒé™è¡¨**

| å­—æ®µ       | æ•°æ®ç±»å‹    | æè¿°                     |
| ---------- | ----------- | ------------------------ |
| problem_id | foreign_key | é¢˜ç›®å”¯ä¸€æ ‡è¯†             |
| price      | Int         | ä»·æ ¼ï¼ˆå•ä½ï¼šSå¸(bushi)ï¼‰ |
| grade      | Int         | é¢˜ç›®çº§åˆ«                 |

**ç”¨æˆ·é¢˜ç›®è§£é”è¡¨**

| å­—æ®µ               | æ•°æ®ç±»å‹       | æè¿°                   |
| ------------------ | -------------- | ---------------------- |
| user_id            | foreign_key    | ç”¨æˆ·å”¯ä¸€æ ‡è¯†           |
| purchased_problems | `List<String>` | è§£é”çš„é¢˜ç›®å”¯ä¸€æ ‡è¯†åˆ—è¡¨ |

**ç”¨æˆ·çº§åˆ«è¡¨**

| å­—æ®µ    | æ•°æ®ç±»å‹    | æè¿°         |
| ------- | ----------- | ------------ |
| user_id | foreign_key | ç”¨æˆ·å”¯ä¸€æ ‡è¯† |
| grade   | Int         | ç”¨æˆ·çº§åˆ«     |

æ™®é€šç”¨æˆ·åªèƒ½ä½“éªŒ**é¢˜ç›®çº§åˆ«**å°äºç­‰äºè‡ªå·±**ç”¨æˆ·çº§åˆ«**çš„é¢˜ç›®ã€‚

å¯¹äºæœªè§£é”ğŸ”“çš„é¢˜ç›®ï¼Œæ™®é€šç”¨æˆ·å¯ä»¥é€šè¿‡**ä»˜è´¹è´­ä¹°**é¢˜ç›®ï¼Œæˆ–è€…æé«˜è‡ªèº«çš„**ç”¨æˆ·çº§åˆ«**æ¥å®ç°åšé¢˜ã€‚

> å¯æ‹“å±•å†…å®¹ï¼šé¢˜ç›®æ¿€æ´»ç ï¼Œæ¶ˆè´¹ä¼˜æƒ åˆ¸

